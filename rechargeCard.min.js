// @ts-nocheck
let database=JSON.parse(localStorage.getItem("cards"))?JSON.parse(localStorage.getItem("cards")):[],displayPin=document.getElementById("recharge-display"),userLoad=document.getElementById("load-airtime"),userBalance=document.getElementById("user-balance"),tbody=document.getElementById("tbody"),userSearch=document.getElementById("search-bar"),userPreview=document.getElementById("preview"),balances=JSON.parse(localStorage.getItem("userBalances"))||{MTN:0,GLO:0,AIRTEL:0,"T2(9MOBILE)":0};function updateStorage(){localStorage.setItem("cards",JSON.stringify(database)),localStorage.setItem("userBalances",JSON.stringify(balances)),showCards(),displayBalance()}function generatePin(){let e="";for(let t=0;t<12;t++)e+=Math.floor(10*Math.random());return e}function userPin(){let e=document.getElementById("network").value,t=document.getElementById("user-amount").value.trim();if(""===e||""===t)return void alert("Abeg select network and amount first! ‚ö†Ô∏è");if(isNaN(t))return void alert("Amount must be a number! ‚ö†Ô∏è");if(t>1e4)return void alert("Maximum amount is 10,000 Naira! ‚ö†Ô∏è");if(t<50)return void alert("Minimum amount is 50 Naira! ‚ö†Ô∏è");let a=generatePin();let n={network:e.toUpperCase(),amount:Number(t),pin:a,used:!1,date:(new Date).toLocaleTimeString(),logo:{MTN:"New-mtn-logo.jpg",GLO:"glo-limited-seeklogo.png",AIRTEL:"airtelMobile.png","T2(9MOBILE)":"T2Mobile.png"}[e.toUpperCase()]};database.push(n),displayPin.innerHTML=` <b>${a}</b>`,alert(`You have successfully generated ${n.network} airtime of ${n.amount}.`),console.log(database),updateStorage()}function loadAirtime(){let e=userLoad.value;if(!e.startsWith("*311*")||!e.endsWith("#"))return alert("Please enter the full PIN in the format *311*PIN#"),void console.log(e);let t=e.slice(5,-1);if(12!==t.length||isNaN(t))return void alert("Check the PIN and try again! Make sure you enter the full PIN in the format *311*PIN#");let a=database.find(e=>t===e.pin);if(a)if(a.used)alert("This card has already been used by you! ‚ùå");else{a.used=!0,balances[a.network]+=a.amount,console.log(balances[a.network]);let e="MTN"===a.network?"Yello!":"Dear Customer,";alert(`${e} You have successfully loaded N${a.amount} ${a.network} airtime. ‚úÖ`)}else alert("Invalid PIN! Abeg check your code. ‚ùå");updateStorage(),console.log(t),console.log(database)}function deleteCard(e){confirm(`You're about to trash ${database[e].network}, Are you sure?`)&&(database.splice(e,1),updateStorage(),console.log(database),console.log(e))}function showCards(){for(let e=0;e<database.length;e++)fillTable()}function fillTable(){tbody.innerHTML="",database.forEach(({network:e,logo:t,amount:a,pin:n,used:o,date:r},l)=>{let d=o?"background-color: rgba(255, 0, 0, 0.2);":"";tbody.innerHTML+=` \n            <tr style="${d}">\n                <td>${l+1}</td>  \n                <td><img src="${t}" alt="${e} logo" width="40" height="40"></td>  \n                <td>${e}</td>  \n                <td>‚Ç¶${a.toLocaleString()}</td> \n                <td>${n}</td>  \n                <td>${o?"Used ‚úÖ":"Unused ‚ùå"}</td>\n                <td>${r}</td>\n                <td style = "background-color: rgb(233, 26, 26); cursor: pointer; text-shadow: 1px 0 5px #FFFFFF;" title="Delete Card" onclick="deleteCard(${l})"> üóëÔ∏è </td>\n            </tr> `})}function displayBalance(){document.getElementById("mtn-bal").innerHTML=balances.MTN.toLocaleString(),document.getElementById("glo-bal").innerHTML=balances.GLO.toLocaleString(),document.getElementById("airtel-bal").innerHTML=balances.AIRTEL.toLocaleString(),document.getElementById("t2-bal").innerHTML=balances["T2(9MOBILE)"].toLocaleString()}function resetBalance(){confirm("You're about to reset your balances to zero, Are you sure?")&&(balances={MTN:0,GLO:0,AIRTEL:0,"T2(9MOBILE)":0},updateStorage())}function searchCards(){let e=document.getElementById("search-input").value.toUpperCase();displayFiltered(database.filter(t=>t.network.includes(e)||t.amount.toString().includes(e)||t.pin.includes(e)))}function displayFiltered(e){tbody.innerHTML="",0!==e.length?e.forEach(({network:e,logo:t,amount:a,pin:n,used:o,date:r},l)=>{let d=o?"background-color: rgba(255, 0, 0, 0.2);":"";tbody.innerHTML+=` \n        <tr style="${d}">\n            <td>${l+1}</td>   \n            <td><img src="${t}" width="40" height="40"></td>   \n            <td>${e}</td>   \n            <td>‚Ç¶${Number(a).toLocaleString()}</td> \n            <td>${n}</td>   \n            <td>${o?"Used ‚úÖ":"Unused ‚ùå"}</td>\n            <td>${r}</td>\n            <td style="background-color: rgb(233, 26, 26); cursor: pointer;" title="Delete Card" onclick="deleteCard(${l})"> üóëÔ∏è </td>\n        </tr> `}):tbody.innerHTML='<tr><td colspan="8" style="text-align:center;">No match found! ‚ùå</td></tr>'}updateStorage(),displayBalance(),console.log(database);